<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="PopGenHelpR">
<title>Creating a Q-matrix to use in PopGenHelpR • PopGenHelpR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Creating a Q-matrix to use in PopGenHelpR">
<meta property="og:description" content="PopGenHelpR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">PopGenHelpR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Manual</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/PopGenHelpR_vignette.html">Vignette</a>
    <a class="dropdown-item" href="../articles/PopGenHelpR_benchmarking.html">Benchmarking</a>
    <a class="dropdown-item" href="../articles/PopGenHelpR_heterozygosity.html">Choosing heterozygosity</a>
    <a class="dropdown-item" href="../articles/PopGenHelpR_PCA.html">Principal Component Analysis</a>
    <a class="dropdown-item" href="../articles/PopGenHelpR_createQmatrix.html">Creating a Q-matrix</a>
    <a class="dropdown-item" href="../articles/PopGenHelpR_sortQmatrix.html">Sorting a Q-matrix</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/kfarleigh/PopGenHelpR">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Creating a Q-matrix to use in PopGenHelpR</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/kfarleigh/PopGenHelpR/blob/HEAD/vignettes/articles/PopGenHelpR_createQmatrix.Rmd" class="external-link"><code>vignettes/articles/PopGenHelpR_createQmatrix.Rmd</code></a></small>
      <div class="d-none name"><code>PopGenHelpR_createQmatrix.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="purpose">Purpose<a class="anchor" aria-label="anchor" href="#purpose"></a>
</h2>
<p>To generate a q-matrix of ancestry coefficients for use in the
<code>PopGenHelpR</code> functions <code>Ancestry_barchart</code> and
<code>Piechart_map</code>.</p>
</div>
<div class="section level2">
<h2 id="what-is-a-q-matrix">What is a Q-matrix?<a class="anchor" aria-label="anchor" href="#what-is-a-q-matrix"></a>
</h2>
<p>A q-matrix is a matrix containing as many rows as individuals and
columns as genetic clusters. Each cell represents an ancestry
coefficient (also known as cluster assignments), which is the
contribution of a genetic cluster to a particular individual. Q-matrices
are commonly used in population genomics to evaluate gene flow between
populations (e.g., admixture) or species (e.g., introgression).
ADMIXTURE (Alexander et al., 2009) and sNMF (Frichot et al., 2014) are
commonly used software to estimate the number of genetic clusters in
data and generate ancestry bar charts with q-matrices.</p>
<p>Let’s generate some q-matrices now that you know what they are! We
will create q-matrices using each of the programs mentioned above.</p>
<div class="section level3">
<h3 id="snmf">sNMF<a class="anchor" aria-label="anchor" href="#snmf"></a>
</h3>
<p>We will start with sNMF because it is implemented in the R package <a href="https://bioconductor.org/packages/release/bioc/html/LEA.html" class="external-link">LEA</a>
(Frichot &amp; Francois, 2015). After running sNMF (see <a href="https://bioconductor.org/packages/release/bioc/vignettes/LEA/inst/doc/LEA.pdf" class="external-link">this
tutorial</a> if you need help) you just need to use the <code>Q</code>
function.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># If I have a sNMF project named sNMFobject with K number of ancestral populations (genetic clusters), and my best run is run 1 (determined as the run with the lowets cross-entropy)</span></span>
<span><span class="va">Qmat</span> <span class="op">&lt;-</span> <span class="fu">Q</span><span class="op">(</span><span class="va">sNMFobject</span>, K <span class="op">=</span> <span class="va">K</span>, run <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>All you need to do now is append the sample names to the q-matrix as
the first column (you can do this with <code>cbind</code> or in any text
editor). Then you can use it in <code>PopGenHelpR</code>. Note that you
must be careful that your order in the q-matrix is the same as the order
of the samples you are appending.</p>
<div class="section level4">
<h4 id="example-of-formatting-the-q-matrix-for-popgenhelpr">Example of formatting the q-matrix for <code>PopGenHelpR</code><a class="anchor" aria-label="anchor" href="#example-of-formatting-the-q-matrix-for-popgenhelpr"></a>
</h4>
<p>Here we show you how to format a q-matrix generated with the
<code>Q</code> function from LEA for use in
<code>PopGenHelpR</code>.</p>
<p>First, we will create a matrix that we may expect from LEA. We also
need to create fake sample names <strong>Please note that this is only a
toy example and is not real data.</strong></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create fake matrix</span></span>
<span><span class="va">Qmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.4</span>, <span class="fl">0.35</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Fake_inds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FS_1"</span>, <span class="st">"FS_2"</span>, <span class="st">"FS_3"</span><span class="op">)</span></span></code></pre></div>
<p>Cool! We have data, so can we use it in <code>PopGenHelpR</code>? No,
because <code>Ancestry_barchart</code> and <code>Piechart_map</code>
need a data.frame or CSV; these functions also need the first column to
be the individual names. <code>PopGenHelpR</code> uses the individual
names as a key to link the q-matrix data with populations and
coordinates.</p>
<p>Let’s add the individual names!</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add the names</span></span>
<span><span class="va">Qmat_wnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">Fake_inds</span>, <span class="va">Qmat</span><span class="op">)</span></span></code></pre></div>
<p>So can we use this <code>Qmat_wnames</code> now? No, because
<code>Qmat_wnames</code> is still a matrix and let’s see what
<code>cbind</code> did to our numeric data. Notice that
<code>cbind</code> make everything a character, we need the cluster
contributions (columns 2 through 4 here) to be numeric. We will fix this
using the <code>sapply</code> function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check the structure of the Qmat_wnames</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">Qmat_wnames</span><span class="op">)</span></span>
<span><span class="co">#&gt;  chr [1:3, 1:4] "FS_1" "FS_2" "FS_3" "0.25" "0.25" "0.25" "0.4" "0.4" "0.4" ...</span></span>
<span><span class="co">#&gt;  - attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   ..$ : NULL</span></span>
<span><span class="co">#&gt;   ..$ : chr [1:4] "Fake_inds" "" "" ""</span></span>
<span></span>
<span><span class="va">Qmat_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">Qmat_wnames</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Qmat_df</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">Qmat_df</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, <span class="va">as.numeric</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check again</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">Qmat_df</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    3 obs. of  4 variables:</span></span>
<span><span class="co">#&gt;  $ Fake_inds: chr  "FS_1" "FS_2" "FS_3"</span></span>
<span><span class="co">#&gt;  $ V2       : num  0.25 0.25 0.25</span></span>
<span><span class="co">#&gt;  $ V3       : num  0.4 0.4 0.4</span></span>
<span><span class="co">#&gt;  $ V4       : num  0.35 0.35 0.35</span></span></code></pre></div>
<p>Notice that our cluster contribution columns are now numeric and that
our <code>Qmat_df</code> object is a data.frame.</p>
<p>Now we can use it in <code>PopGenHelpR</code> with a population
assignment file/data.frame to generate figures.</p>
</div>
</div>
<div class="section level3">
<h3 id="admixture">ADMIXTURE<a class="anchor" aria-label="anchor" href="#admixture"></a>
</h3>
<p>ADMIXTURE is a little more complex because it is not associated with
an R package, but it is nice because it gives us the q-matrix
automatically. See <a href="https://speciationgenomics.github.io/ADMIXTURE/" class="external-link">this tutorial</a>
for more details.</p>
<p>In the example below, we tell ADMIXTURE to use a bed file as input
and run the analysis with a K value of 5.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="do">### Run ADMIXTURE</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>admixture <span class="sc">--</span>cv my_genetic_data.bed <span class="dv">5</span> <span class="sc">&gt;</span> K5.out</span></code></pre></div>
<p>This will output a file with the .Q extension, which contains
ancestry coefficients for each individual (our q-matrix).</p>
</div>
</div>
<div class="section level2">
<h2 id="questions">Questions???<a class="anchor" aria-label="anchor" href="#questions"></a>
</h2>
<p>Please email Keaka Farleigh (<a href="mailto:farleik@miamioh.edu" class="email">farleik@miamioh.edu</a>) if you need help generating a
q-matrix or with anything else.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Alexander, D. H., Novembre, J., &amp; Lange, K. (2009). Fast
model-based estimation of ancestry in unrelated individuals. Genome
research, 19(9), 1655-1664.</p>
<p>Frichot, E., &amp; François, O. (2015). LEA: An R package for
landscape and ecological association studies. Methods in Ecology and
Evolution, 6(8), 925-929.</p>
<p>Frichot, E., Mathieu, F., Trouillon, T., Bouchard, G., &amp;
François, O. (2014). Fast and efficient estimation of individual
ancestry coefficients. Genetics, 196(4), 973-983.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Keaka Farleigh, Mason Murphy, Christopher Blair, Tereza Jezkova.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>PopGenHelpR is funded by an National Science Foundation (NSF) Graduate Research Fellowship to KF (Award 2037786), an NSF grant to CB (DEB-1929679), and an NSF career grant to TJ (DEB-2144047).</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
