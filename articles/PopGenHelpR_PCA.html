<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Principal component analysis in PopGenHelpR • PopGenHelpR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Principal component analysis in PopGenHelpR">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">PopGenHelpR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Manual</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/PopGenHelpR_vignette.html">Vignette</a></li>
    <li><a class="dropdown-item" href="../articles/PopGenHelpR_benchmarking.html">Benchmarking</a></li>
    <li><a class="dropdown-item" href="../articles/PopGenHelpR_heterozygosity.html">Choosing heterozygosity</a></li>
    <li><a class="dropdown-item" href="../articles/PopGenHelpR_PCA.html">Principal Component Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/PopGenHelpR_createQmatrix.html">Creating a Q-matrix</a></li>
    <li><a class="dropdown-item" href="../articles/PopGenHelpR_sortQmatrix.html">Sorting a Q-matrix</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/kfarleigh/PopGenHelpR"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Principal component analysis in PopGenHelpR</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/kfarleigh/PopGenHelpR/blob/main/vignettes/articles/PopGenHelpR_PCA.Rmd" class="external-link"><code>vignettes/articles/PopGenHelpR_PCA.Rmd</code></a></small>
      <div class="d-none name"><code>PopGenHelpR_PCA.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="purpose">Purpose<a class="anchor" aria-label="anchor" href="#purpose"></a>
</h2>
<p>To perform principal component analysis using the <code>PCA</code>
function in <code>PopGenHelpR</code>.</p>
</div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>Principal component analysis (PCA) is a widely used technique to
identify patterns of genetic structure in genomic data or any data
really. PCA is commonly paired with structure-like analyses since PCA is
model-free, meaning that it is not based on any biological model (see
Patterson et al., 2006 for a discussion on model vs model-free
approaches).</p>
<p>We will perform PCA and visualize the results. <strong><em>Note that
we use <code>ggplot2</code> to visualize the results, not
<code>PopGenHelpR</code>.</em></strong></p>
<div class="section level3">
<h3 id="load-the-data">Load the data<a class="anchor" aria-label="anchor" href="#load-the-data"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load PopGenHelpR</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://kfarleigh.github.io/PopGenHelpR/">PopGenHelpR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"HornedLizard_VCF"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"HornedLizard_Pop"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="performing-a-pca-in-popgenhelpr">Performing a PCA in <code>PopGenHelpR</code><a class="anchor" aria-label="anchor" href="#performing-a-pca-in-popgenhelpr"></a>
</h2>
<p>Running a PCA in <code>PopGenHelpR</code> is straightforward and only
requires the genetic data. One caveat is that the data must be complete,
meaning that there is no missing data. This means that you will have to
impute most genomic data sets, or perform stringent filtering; I usually
use <code>LEA</code> to impute my data (Frichot et al., 2015).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">HL_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PCA.html">PCA</a></span><span class="op">(</span><span class="va">HornedLizard_VCF</span><span class="op">)</span></span></code></pre></div>
<p>Our <code>HL_pca</code> object is a list with two elements. First, we
have the loadings of each individual (sample) on the principal
components. Second, we have the percent variance explained by each
principal component (PC). We expect that the first few PCs will explain
the majority of the variance, and most researchers generate PCA scatter
plots using the first few PCs.</p>
</div>
<div class="section level2">
<h2 id="visualizng-the-pca-results">Visualizng the PCA results<a class="anchor" aria-label="anchor" href="#visualizng-the-pca-results"></a>
</h2>
<p>Let’s see how much variance is explained by the first 10 PCs.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Var_exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">HL_pca</span><span class="op">$</span><span class="va">`Variance Explained`</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Var_exp</span><span class="op">$</span><span class="va">PC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Var_exp</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Plot the percent variance explained</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">Var_exp</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PC</span>, y <span class="op">=</span> <span class="va">`Percent variance explained`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<p><img src="PCA_varplot.png" width="600px" height="350px" style="display: block; margin: auto;"></p>
<p>We see that the first two principal components account for the
majority of the variance, so we will generate a pca scatter plot using
those axes. We will color the points according to which
population/genetic cluster they belong to. This is commonly done to see
if both model-free (e.g., PCA) and model-based (e.g., sNMF) analyses
agree.</p>
<p>This will also require additional information (a population
assignment file) to color the points.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the population information</span></span>
<span><span class="va">Pop</span> <span class="op">&lt;-</span> <span class="va">HornedLizard_Pop</span></span>
<span></span>
<span><span class="co"># Check to see if the PCA individuals and Pop indivudals are  ordered in the same way, we expect it to be TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">Dat_loadings</span><span class="op">)</span> <span class="op">==</span> <span class="va">Pop</span><span class="op">$</span><span class="va">Sample</span></span>
<span></span>
<span><span class="co"># Isolate loadings for the first 2 PCs</span></span>
<span><span class="va">Scores_toplot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">Dat_loadings</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">Scores_toplot</span><span class="op">$</span><span class="va">group</span> <span class="op">&lt;-</span> <span class="va">Pop</span><span class="op">$</span><span class="va">Population</span></span>
<span></span>
<span><span class="co"># Set colors for each group</span></span>
<span><span class="va">Scores_toplot</span><span class="op">$</span><span class="va">group</span><span class="op">[</span><span class="va">Scores_toplot</span><span class="op">$</span><span class="va">group</span> <span class="op">==</span> <span class="st">'South'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"#d73027"</span> </span>
<span><span class="va">Scores_toplot</span><span class="op">$</span><span class="va">group</span><span class="op">[</span><span class="va">Scores_toplot</span><span class="op">$</span><span class="va">group</span> <span class="op">==</span> <span class="st">'East'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"#74add1"</span></span>
<span><span class="va">Scores_toplot</span><span class="op">$</span><span class="va">group</span><span class="op">[</span><span class="va">Scores_toplot</span><span class="op">$</span><span class="va">group</span> <span class="op">==</span> <span class="st">'West'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"#313695"</span></span>
<span></span>
<span><span class="co"># Create a custom theme</span></span>
<span><span class="va">theme</span><span class="op">&lt;-</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,panel.border<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill<span class="op">=</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>             panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>             strip.background<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text.x<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>colour<span class="op">=</span><span class="st">"black"</span><span class="op">)</span>,</span>
<span>             axis.text.y<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>colour<span class="op">=</span><span class="st">"black"</span><span class="op">)</span>,axis.ticks<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>colour<span class="op">=</span><span class="st">"black"</span><span class="op">)</span>,</span>
<span>             plot.margin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,<span class="st">"line"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot and include the variance explained by the axes wer are plotting</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">Scores_toplot</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PC1</span>, y <span class="op">=</span> <span class="va">PC2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>, color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="va">Scores_toplot</span><span class="op">$</span><span class="va">group</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_identity.html" class="external-link">scale_shape_identity</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="va">theme</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"PC2 ("</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">Dat_pc_var</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span>,<span class="fl">2</span><span class="op">)</span>,<span class="st">"% variance explained)"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"PC1 ("</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">Dat_pc_var</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>,<span class="fl">2</span><span class="op">)</span>,<span class="st">"% variance explained)"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="PCA_scatterplot.png" width="600px" height="350px" style="display: block; margin: auto;"></p>
<p>We see that there are 3 main clusters in our PCA and that the
individuals largely cluster by the population/genetic cluster that was
assigned by sNMF, with the exception of sample E_71_7760.</p>
</div>
<div class="section level2">
<h2 id="questions">Questions???<a class="anchor" aria-label="anchor" href="#questions"></a>
</h2>
<p>Please email Keaka Farleigh (<a href="mailto:farleik@miamioh.edu" class="email">farleik@miamioh.edu</a>) if you need help generating a
q-matrix or with anything else.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>Frichot, E., &amp; François, O. (2015). LEA: An R package for
landscape and ecological association studies. Methods in Ecology and
Evolution, 6(8), 925-929. <a href="https://doi.org/10.1111/2041-210X.12382" class="external-link uri">https://doi.org/10.1111/2041-210X.12382</a>
</li>
<li>Patterson, N., Price, A. L., &amp; Reich, D. (2006). Population
structure and eigenanalysis. PLoS genetics, 2(12), e190. <a href="https://doi.org/10.1371/journal.pgen.0020190" class="external-link uri">https://doi.org/10.1371/journal.pgen.0020190</a>
</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Keaka Farleigh, Mason Murphy, Christopher Blair, Tereza Jezkova.</p>
</div>

<div class="pkgdown-footer-right">
  <p>PopGenHelpR is funded by an National Science Foundation (NSF) Graduate Research Fellowship to KF (Award 2037786), an NSF grant to CB (DEB-1929679), and an NSF career grant to TJ (DEB-2144047).</p>
</div>

    </footer>
</div>





  </body>
</html>
